import numpy as np
def kinematics(phi, theta,xi):
	L = 0.15
	r=0.0125
	res = np.zeros((4,4))
	res[0,0]= 1 + xi ** 12 * phi ** 12 / 479001600 + (theta ** 2 - 1) * xi ** 10 * phi ** 10 / 3628800 + xi ** 8 * (theta ** 4 - 3 * theta ** 2 + 3) * phi ** 8 / 120960 + xi ** 6 * (theta ** 6 - 0.15e2 / 0.2e1 * theta ** 4 + 0.45e2 / 0.2e1 * theta ** 2 - 0.45e2 / 0.2e1) * phi ** 6 / 16200 + xi ** 4 * (theta ** 8 - 14 * theta ** 6 + 105 * theta ** 4 - 315 * theta ** 2 + 315) * phi ** 4 / 7560 + (theta ** 10 - 0.45e2 / 0.2e1 * theta ** 8 + 315 * theta ** 6 - 0.4725e4 / 0.2e1 * theta ** 4 + 0.14175e5 / 0.2e1 * theta ** 2 - 0.14175e5 / 0.2e1) * xi ** 2 * phi ** 2 / 14175
	res[0,1]= -xi ** 2 * theta * phi ** 2 * (xi ** 8 * phi ** 8 + 60 * phi ** 6 * theta ** 2 * xi ** 6 - 90 * phi ** 6 * xi ** 6 + 672 * phi ** 4 * theta ** 4 * xi ** 4 - 3360 * phi ** 4 * theta ** 2 * xi ** 4 + 1920 * phi ** 2 * theta ** 6 * xi ** 2 + 5040 * phi ** 4 * xi ** 4 - 20160 * phi ** 2 * theta ** 4 * xi ** 2 + 1280 * theta ** 8 + 100800 * phi ** 2 * theta ** 2 * xi ** 2 - 23040 * theta ** 6 - 151200 * phi ** 2 * xi ** 2 + 241920 * theta ** 4 - 1209600 * theta ** 2 + 1814400) / 3628800
	res[0,2]= -xi * phi * (-39916800 + xi ** 10 * phi ** 10 + 55 * phi ** 8 * theta ** 2 * xi ** 8 + 330 * phi ** 6 * theta ** 4 * xi ** 6 + 462 * phi ** 4 * theta ** 6 * xi ** 4 + 165 * phi ** 2 * theta ** 8 * xi ** 2 + 11 * theta ** 10 - 110 * (phi ** 2 * xi ** 2 + 3 * theta ** 2) * (phi ** 6 * xi ** 6 + 33 * phi ** 4 * theta ** 2 * xi ** 4 + 27 * phi ** 2 * theta ** 4 * xi ** 2 + 3 * theta ** 6) + 7920 * phi ** 6 * xi ** 6 + 166320 * phi ** 4 * theta ** 2 * xi ** 4 + 277200 * phi ** 2 * theta ** 4 * xi ** 2 + 55440 * theta ** 6 - 332640 * phi ** 4 * xi ** 4 - 3326400 * phi ** 2 * theta ** 2 * xi ** 2 - 1663200 * theta ** 4 + 6652800 * phi ** 2 * xi ** 2 + 19958400 * theta ** 2) / 39916800
	res[0,3]= -phi * xi ** 2 * (xi ** 10 * phi ** 10 + 66 * phi ** 8 * theta ** 2 * xi ** 8 - 132 * xi ** 8 * phi ** 8 + 495 * phi ** 6 * theta ** 4 * xi ** 6 - 5940 * phi ** 6 * theta ** 2 * xi ** 6 + 924 * phi ** 4 * theta ** 6 * xi ** 4 + 11880 * phi ** 6 * xi ** 6 - 27720 * phi ** 4 * theta ** 4 * xi ** 4 + 495 * phi ** 2 * theta ** 8 * xi ** 2 + 332640 * phi ** 4 * theta ** 2 * xi ** 4 - 27720 * phi ** 2 * theta ** 6 * xi ** 2 + 66 * theta ** 10 - 665280 * phi ** 4 * xi ** 4 + 831600 * phi ** 2 * theta ** 4 * xi ** 2 - 5940 * theta ** 8 - 9979200 * phi ** 2 * theta ** 2 * xi ** 2 + 332640 * theta ** 6 + 19958400 * phi ** 2 * xi ** 2 - 9979200 * theta ** 4 + 119750400 * theta ** 2 - 239500800) * L / 479001600

	res[1,0]= -xi ** 2 * theta * (xi ** 16 * phi ** 16 + 204 * phi ** 14 * theta ** 2 * xi ** 14 - 306 * phi ** 14 * xi ** 14 + 9792 * phi ** 12 * theta ** 4 * xi ** 12 - 48960 * phi ** 12 * theta ** 2 * xi ** 12 + 169728 * phi ** 10 * theta ** 6 * xi ** 10 + 73440 * xi ** 12 * phi ** 12 - 1782144 * phi ** 10 * theta ** 4 * xi ** 10 + 1244672 * phi ** 8 * theta ** 8 * xi ** 8 + 8910720 * phi ** 10 * theta ** 2 * xi ** 10 - 22404096 * phi ** 8 * theta ** 6 * xi ** 8 + 4073472 * phi ** 6 * theta ** 10 * xi ** 6 - 13366080 * xi ** 10 * phi ** 10 + 235243008 * phi ** 8 * theta ** 4 * xi ** 8 - 112020480 * phi ** 6 * theta ** 8 * xi ** 6 + 5849088 * phi ** 4 * theta ** 12 * xi ** 4 - 1176215040 * phi ** 8 * theta ** 2 * xi ** 8 + 2016368640 * phi ** 6 * theta ** 6 * xi ** 6 - 228114432 * phi ** 4 * theta ** 10 * xi ** 4 + 3342336 * phi ** 2 * theta ** 14 * xi ** 2 + 1764322560 * xi ** 8 * phi ** 8 - 21171870720 * phi ** 6 * theta ** 4 * xi ** 6 + 6273146880 * phi ** 4 * theta ** 8 * xi ** 4 - 175472640 * phi ** 2 * theta ** 12 * xi ** 2 + 589824 * theta ** 16 + 105859353600 * phi ** 6 * theta ** 2 * xi ** 6 - 112916643840 * phi ** 4 * theta ** 6 * xi ** 4 + 6843432960 * theta ** 10 * phi ** 2 * xi ** 2 - 40108032 * theta ** 14 - 158789030400 * phi ** 6 * xi ** 6 + 1185624760320 * phi ** 4 * theta ** 4 * xi ** 4 - 188194406400 * phi ** 2 * theta ** 8 * xi ** 2 + 2105671680 * theta ** 12 - 5928123801600 * phi ** 4 * theta ** 2 * xi ** 4 + 3387499315200 * phi ** 2 * theta ** 6 * xi ** 2 - 82121195520 * theta ** 10 + 8892185702400 * phi ** 4 * xi ** 4 - 35568742809600 * phi ** 2 * theta ** 4 * xi ** 2 + 2258332876800 * theta ** 8 + 177843714048000 * phi ** 2 * theta ** 2 * xi ** 2 - 40649991782400 * theta ** 6 - 266765571072000 * phi ** 2 * xi ** 2 + 426824913715200 * theta ** 4 - 2134124568576000 * theta ** 2 + 3201186852864000) * phi ** 2 / 6402373705728000
	res[1,1]= 1 - theta ** 10 * phi ** 2 * xi ** 2 / 14175 - xi ** 2 * phi ** 2 * (phi ** 2 * xi ** 2 - 12) * theta ** 8 / 7560 - xi ** 2 * phi ** 2 * (phi ** 4 * xi ** 4 - 30 * phi ** 2 * xi ** 2 + 360) * theta ** 6 / 16200 - xi ** 2 * phi ** 2 * (phi ** 6 * xi ** 6 - 56 * phi ** 4 * xi ** 4 + 1680 * phi ** 2 * xi ** 2 - 20160) * theta ** 4 / 120960 - xi ** 2 * phi ** 2 * (xi ** 8 * phi ** 8 - 90 * phi ** 6 * xi ** 6 + 5040 * phi ** 4 * xi ** 4 - 151200 * phi ** 2 * xi ** 2 + 1814400) * theta ** 2 / 3628800
	res[1,2]= -xi * theta * phi * (-39916800 + xi ** 10 * phi ** 10 + 0.55e2 / 0.3e1 * phi ** 8 * theta ** 2 * xi ** 8 + 66 * phi ** 6 * theta ** 4 * xi ** 6 + 66 * phi ** 4 * theta ** 6 * xi ** 4 + 0.55e2 / 0.3e1 * phi ** 2 * theta ** 8 * xi ** 2 + theta ** 10 - 110 * (phi ** 4 * xi ** 4 + 2 * phi ** 2 * theta ** 2 * xi ** 2 + theta ** 4 / 5) * (phi ** 4 * xi ** 4 + 10 * phi ** 2 * theta ** 2 * xi ** 2 + 5 * theta ** 4) + 7920 * (phi ** 2 * xi ** 2 + theta ** 2) * (phi ** 4 * xi ** 4 + 6 * phi ** 2 * theta ** 2 * xi ** 2 + theta ** 4) - 332640 * phi ** 4 * xi ** 4 - 1108800 * phi ** 2 * theta ** 2 * xi ** 2 - 332640 * theta ** 4 + 6652800 * phi ** 2 * xi ** 2 + 6652800 * theta ** 2) / 39916800
	res[1,3]= phi * xi ** 2 * (xi ** 8 * phi ** 8 + 15 * phi ** 6 * theta ** 2 * xi ** 6 - 90 * phi ** 6 * xi ** 6 + 42 * phi ** 4 * theta ** 4 * xi ** 4 - 840 * phi ** 4 * theta ** 2 * xi ** 4 + 30 * phi ** 2 * theta ** 6 * xi ** 2 + 5040 * phi ** 4 * xi ** 4 - 1260 * phi ** 2 * theta ** 4 * xi ** 2 + 5 * theta ** 8 + 25200 * phi ** 2 * theta ** 2 * xi ** 2 - 360 * theta ** 6 - 151200 * phi ** 2 * xi ** 2 + 15120 * theta ** 4 - 302400 * theta ** 2 + 1814400) * theta * L / 3628800

	res[2,0]= xi * (-121645100408832000 - 1013709170073600 * phi ** 4 * xi ** 4 + 20274183401472000 * phi ** 2 * xi ** 2 + 24135932620800 * phi ** 6 * xi ** 6 + 506854585036800 * phi ** 4 * theta ** 2 * xi ** 4 + 844757641728000 * phi ** 2 * theta ** 4 * xi ** 2 - 10137091700736000 * phi ** 2 * theta ** 2 * xi ** 2 - 253955520 * theta ** 12 + 93024 * (phi ** 2 * xi ** 2 + 3 * theta ** 2) * (phi ** 4 * xi ** 4 + 10 * phi ** 2 * theta ** 2 * xi ** 2 + 5 * theta ** 4) * (xi ** 8 * phi ** 8 + 92 * phi ** 6 * theta ** 2 * xi ** 6 + 134 * phi ** 4 * theta ** 4 * xi ** 4 + 28 * phi ** 2 * theta ** 6 * xi ** 2 + theta ** 8) + 3047466240 * xi ** 10 * phi ** 10 - 5814 * theta ** 16 + 19 * theta ** 18 - 335221286400 * (phi ** 2 * xi ** 2 + 3 * theta ** 2) * (phi ** 6 * xi ** 6 + 33 * phi ** 4 * theta ** 2 * xi ** 4 + 27 * phi ** 2 * theta ** 4 * xi ** 2 + 3 * theta ** 6) + 167610643200 * phi ** 8 * theta ** 2 * xi ** 8 + 1005663859200 * phi ** 6 * theta ** 4 * xi ** 6 + 1407929402880 * phi ** 4 * theta ** 6 * xi ** 4 + 502831929600 * phi ** 2 * theta ** 8 * xi ** 2 + 171 * phi ** 16 * theta ** 2 * xi ** 16 + 3876 * phi ** 14 * theta ** 4 * xi ** 14 + 27132 * phi ** 12 * theta ** 6 * xi ** 12 + 75582 * phi ** 10 * theta ** 8 * xi ** 10 + 92378 * phi ** 8 * theta ** 10 * xi ** 8 + 50388 * phi ** 6 * theta ** 12 * xi ** 6 + 11628 * phi ** 4 * theta ** 14 * xi ** 4 + 969 * phi ** 2 * theta ** 16 * xi ** 2 - 46512 * phi ** 14 * theta ** 2 * xi ** 14 - 813960 * phi ** 12 * theta ** 4 * xi ** 12 - 4232592 * phi ** 10 * theta ** 6 * xi ** 10 - 8314020 * phi ** 8 * theta ** 8 * xi ** 8 - 6651216 * phi ** 6 * theta ** 10 * xi ** 6 - 2116296 * phi ** 4 * theta ** 12 * xi ** 4 - 232560 * phi ** 2 * theta ** 14 * xi ** 2 - 1523733120 * phi ** 10 * theta ** 2 * xi ** 10 - 13967553600 * phi ** 8 * theta ** 4 * xi ** 8 - 33522128640 * phi ** 6 * theta ** 6 * xi ** 6 - 25141596480 * phi ** 4 * theta ** 8 * xi ** 4 - 5587021440 * theta ** 10 * phi ** 2 * xi ** 2 - 342 * xi ** 16 * phi ** 16 + xi ** 18 * phi ** 18 + 60822550204416000 * theta ** 2 - 5068545850368000 * theta ** 4 + 168951528345600 * theta ** 6 + 33522128640 * theta ** 10 - 19535040 * xi ** 12 * phi ** 12) * phi / 121645100408832000
	res[2,1]= -xi * theta * phi * (355687428096000 + (phi ** 6 * xi ** 6 + 9 * phi ** 4 * theta ** 2 * xi ** 4 + 11 * phi ** 2 * theta ** 4 * xi ** 2 + theta ** 6 / 3) * (phi ** 6 * xi ** 6 + 33 * phi ** 4 * theta ** 2 * xi ** 4 + 27 * phi ** 2 * theta ** 4 * xi ** 2 + 3 * theta ** 6) * (phi ** 2 * xi ** 2 + theta ** 2 / 3) * (phi ** 2 * xi ** 2 + 3 * theta ** 2) - 272 * (phi ** 2 * xi ** 2 + theta ** 2) * (phi ** 4 * xi ** 4 + 6 * phi ** 2 * theta ** 2 * xi ** 2 + theta ** 4) * (xi ** 8 * phi ** 8 + 28 * phi ** 6 * theta ** 2 * xi ** 6 + 70 * phi ** 4 * theta ** 4 * xi ** 4 + 28 * phi ** 2 * theta ** 6 * xi ** 2 + theta ** 8) + 57120 * (phi ** 6 * xi ** 6 + 21 * phi ** 4 * theta ** 2 * xi ** 4 + 35 * phi ** 2 * theta ** 4 * xi ** 2 + 7 * theta ** 6) * (phi ** 6 * xi ** 6 + 5 * phi ** 4 * theta ** 2 * xi ** 4 + 3 * phi ** 2 * theta ** 4 * xi ** 2 + theta ** 6 / 7) - 8910720 * (phi ** 4 * xi ** 4 + 14 * phi ** 2 * theta ** 2 * xi ** 2 + theta ** 4) * (phi ** 2 * xi ** 2 + theta ** 2) * (phi ** 2 * xi ** 2 + theta ** 2 / 3) * (phi ** 2 * xi ** 2 + 3 * theta ** 2) + 980179200 * (phi ** 4 * xi ** 4 + 2 * phi ** 2 * theta ** 2 * xi ** 2 + theta ** 4 / 5) * (phi ** 4 * xi ** 4 + 10 * phi ** 2 * theta ** 2 * xi ** 2 + 5 * theta ** 4) - 70572902400 * (phi ** 2 * xi ** 2 + theta ** 2) * (phi ** 4 * xi ** 4 + 6 * phi ** 2 * theta ** 2 * xi ** 2 + theta ** 4) + 2964061900800 * (phi ** 2 * xi ** 2 + theta ** 2 / 3) * (phi ** 2 * xi ** 2 + 3 * theta ** 2) - 59281238016000 * phi ** 2 * xi ** 2 - 59281238016000 * theta ** 2) / 355687428096000
	res[2,2]= 1 - phi ** 2 * xi ** 2 / 2 + phi ** 4 * xi ** 4 / 24 - phi ** 6 * xi ** 6 / 720 + xi ** 8 * phi ** 8 / 40320 - xi ** 10 * phi ** 10 / 3628800 + xi ** 12 * phi ** 12 / 479001600
	res[2,3]= -xi * L * (xi ** 10 * phi ** 10 - 110 * xi ** 8 * phi ** 8 + 7920 * phi ** 6 * xi ** 6 - 332640 * phi ** 4 * xi ** 4 + 6652800 * phi ** 2 * xi ** 2 - 39916800) / 39916800
	
	res[3,3]=1
	return res



def section_kinematics(config, section, xi):
    if section == 0:
        m=kinematics(config[0],config[1],xi)
    if section == 1:
        m1=kinematics(config[0],config[1],1)
        m2=kinematics(config[2],config[3],xi)
        m=m1.dot(m2)
    else:
        m1=kinematics(config[0],config[1],1)
        m2=kinematics(config[2],config[3],1)
        m3=kinematics(config[4],config[5],xi)
        m=m1.dot(m2).dot(m3)
    return m.T[3][0:3]

